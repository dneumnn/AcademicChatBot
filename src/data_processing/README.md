# Data Pre-Processing

This package provides a **data pipeline** designed to pre-process information from YouTube videos or playlists. The pipeline is initialized through the `/analyze` endpoint in the **FastAPI** application. By passing a valid YouTube video or playlist, the pipeline performs the following tasks:

1. Extracts descriptive information for relevant key frames in the video.
2. Enhances the provided transcript or subtitles for improved accuracy and quality.
3. Stores the processed results in organized directories under the `/media` folder.

These pre-processed outputs are structured for further use by the **GraphDB** and **VectorDB** packages, enabling seamless integration.

## Data Pipeline

**1. URL validation:** Verifies whether the input is a valid YouTube video or playlist URL.  
**2. URL Queue Management:** Adds valid video URLs to a list of pending URLs to be processed.  
**3. Video Download:** Attempts to download the video using **pytube**. If unsuccessful, it falls back to **yt_dlp**.  
**4. Metadata Extraction:** Extracts essential metadata (such as title, channel, or duration) from the video.  
**5. Frame Extraction:** Captures key frames from the video at predefined intervals.  
**6. Frame Description:** Uses a Large Language Model **(LLM)** to generate descriptive captions for each extracted frame.  
**7. Transcript Extraction:** Retrieves the video transcript or subtitles.  
**8. Transcript Enhancement:** Appends a fitting timestamp for each sentence and enhances the transcript quality through a **LLM**.  
**9. Data Chunking:** Combines processed sentences into structured, manageable chunks for downstream tasks.  
**10. Processing Log:** Records the video URL in a list of processed URLs to prevent duplicate processing.  

Steps 3 to 10 are repeated for every video that should be processed, if a playlist was passed to the pipeline.

## Output

All processed data is organized under the `/media` folder with the following subdirectories:

- `/media/frames`  
Contains extracted frames from videos.  
- `/media/frames_description`  
Stores frame descriptions generated by the LLM.  
- `/media/transcripts`  
Includes enhanced video transcripts.  

## Usage

The usage of this package is streamlined and easy. Ensure the **FastAPI server** is running by starting it from the `main.py` file. Once the server is active, you can make a POST request to the `/analyze` endpoint.

### Method

`POST`

#### Query Parameter

| Parameter | Type | Description |
| --- | --- | --- |
| `video_input` | `string` | The URL of the YouTube video or playlist to analyze. |

#### Response

The endpoint will return a status indicating whether the processing was successful. Once completed, the pre-processed data can be found in the `/media` folder.

#### Example Request

Assuming the **FastAPI server** is running locally on its default port `8000`, you can use the following `curl` command to analyze a YouTube video:

`$ curl -X POST "http://127.0.0.1:8000/analyze?video_input=https://www.youtube.com/watch?v=dQw4w9WgXcQ"`

---

<picture>
  <source srcset="/media/images/pre-processing-pipeline-dark.svg" media="(prefers-color-scheme: dark)">
  <img src="/media/images/pre-processing-pipeline.svg" alt="Data Pipeline Image">
</picture>

